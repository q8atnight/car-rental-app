{% extends 'base.html' %}
{% block title %}Due Summary{% endblock %}
{% block content %}
<h1>Amount Due</h1>
<p><strong>Car:</strong> {{ rental.car.licence_plate }} â€“ {{ rental.car.model }}<br>
<strong>Customer:</strong> {{ rental.customer.name }}</p>

<div class="card bg-dark border-secondary mb-3">
  <div class="card-body">
    <h5 class="card-title">Rental Period</h5>
    <p class="card-text">Start: {{ rental.start_date.strftime('%d/%m/%Y') }}<br>
    End: {{ rental.end_date.strftime('%d/%m/%Y') if rental.end_date else 'Open' }}<br>
    Billed intervals: {{ intervals }}</p>
  </div>
</div>

<div class="row">
  <div class="col-md-4 mb-3">
    <div class="card bg-dark border-secondary">
      <div class="card-body">
        <div class="h6 text-muted">Base Rent Due</div>
        <div class="display-6">{{ base_due | round(2) }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-4 mb-3">
    <div class="card bg-dark border-secondary">
      <div class="card-body">
        <div class="h6 text-muted">Outstanding Charges</div>
        <div class="display-6">{{ charges_due | round(2) }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-4 mb-3">
    <div class="card bg-dark border-secondary">
      <div class="card-body">
        <div class="h6 text-muted">Payments Recorded</div>
        <div class="display-6">{{ total_payments | round(2) }}</div>
      </div>
    </div>
  </div>
</div>

<h4>Outstanding Items</h4>
<ul class="list-group list-group-flush mb-4">
  {% for f in outstanding_fines %}
  <li class="list-group-item bg-dark text-light">Fine ({{ f.date.strftime('%d/%m/%Y') }}): {{ f.amount }} AED</li>
  {% endfor %}
  {% for d in outstanding_damages %}
  <li class="list-group-item bg-dark text-light">Damage ({{ d.date.strftime('%d/%m/%Y') }}): {{ d.amount }} AED</li>
  {% endfor %}
  {% for s in outstanding_salik %}
  <li class="list-group-item bg-dark text-light">Salik ({{ s.start_date.strftime('%d/%m/%Y') }}-{{ s.end_date.strftime('%d/%m/%Y') }}): {{ s.amount }} AED</li>
  {% endfor %}
  {% if not outstanding_fines and not outstanding_damages and not outstanding_salik %}
  <li class="list-group-item bg-dark text-light">No outstanding fines, damages or Salik.</li>
  {% endif %}
</ul>

<div class="card bg-dark border-primary">
  <div class="card-body">
    <h4>Total Due</h4>
    <p class="display-5">{{ due_amount | round(2) }} AED</p>
  </div>
</div>

<a href="{{ url_for('add_payment', rental_id=rental.id) }}" class="btn btn-success mt-3">Record Payment</a>
<a href="{{ url_for('list_rentals') }}" class="btn btn-secondary mt-3">Back to Rentals</a>

{% endblock %}